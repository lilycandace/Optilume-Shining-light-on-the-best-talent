<!doctype html>
{% load static %}
<html lang="en">
<head>
    <title>Optilume AI</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="{% static 'mysite/css/custom-bs.css' %}">
    <link rel="stylesheet" href="{% static 'mysite/css/jquery.fancybox.min.css' %}">
    <link rel="stylesheet" href="{% static 'mysite/css/bootstrap-select.min.css' %}">
    <link rel="stylesheet" href="{% static 'mysite/fonts/icomoon/style.css' %}">
    <link rel="stylesheet" href="{% static 'mysite/fonts/line-icons/style.css' %}">
    <link rel="stylesheet" href="{% static 'mysite/css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'mysite/css/animate.min.css' %}">
    <link rel="stylesheet" href="{% static 'mysite/css/style.css' %}">
    {% block link_section %}{% endblock %}
</head>

<body id="top">
<div id="overlayer"></div>
<div class="loader">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<div class="site-wrap">
    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
            <div class="site-mobile-menu-close mt-3">
                <span class="icon-close2 js-menu-toggle"></span>
            </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div>

    <header class="site-navbar mt-3">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="site-logo col-6">
                    <img src="{% static 'mysite/images/logo.png' %}" width="200px" height="150px" alt="Image" />
                </div>

                <nav class="mx-auto site-navigation">
                    <ul class="site-menu js-clone-nav d-none d-xl-block ml-0 pl-0">
                        <li><a href="{% url 'index' %}" class="nav-link active">Home</a></li>
                        <li><a href="{% url 'about' %}">About</a></li>
                        <li><a href="{% url 'job-listings' %}">Job Listings</a></li>
                        <li><a href="{% url 'contact' %}">Contact</a></li>
                        {% if user.is_authenticated %}
                            <li>Hello, {{ user.username }}</li>
                            <li><a href="{% url 'logout' %}">Log Out</a></li>
                        {% else %}
                            <li><a href="{% url 'register' %}">Sign Up</a></li>
                        {% endif %}
                    </ul>
                </nav>

                <div class="right-cta-menu text-right d-flex aligin-items-center col-6">
                    <div class="ml-auto">
                        {% if user.is_authenticated and user.is_active and user.is_staff %}
                            <a href="{% url 'post-job' %}" class="btn btn-outline-white border-width-2 d-none d-lg-inline-block"><span class="mr-2 icon-add"></span>Post a Job</a>
                        {% else %}
                            <a href="{% url 'login' %}" class="btn btn-info border-width-2 d-none d-lg-inline-block"><span class="mr-2 icon-lock_outline"></span>Log In</a>
                        {% endif %}
                    </div>
                    <a href="#" class="site-menu-toggle js-menu-toggle d-inline-block d-xl-none mt-lg-2 ml-3"><span class="icon-menu h3 m-0 p-0 mt-2"></span></a>
                </div>
            </div>
        </div>
    </header>

    {% block body %}{% endblock %}
</div>

<!-- SCRIPTS -->
<script src="{% static 'mysite/js/jquery.min.js' %}"></script>
<script src="{% static 'mysite/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'mysite/js/isotope.pkgd.min.js' %}"></script>
<script src="{% static 'mysite/js/stickyfill.min.js' %}"></script>
<script src="{% static 'mysite/js/jquery.fancybox.min.js' %}"></script>
<script src="{% static 'mysite/js/jquery.easing.1.3.js' %}"></script>
<script src="{% static 'mysite/js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'mysite/js/jquery.animateNumber.min.js' %}"></script>
<script src="{% static 'mysite/js/owl.carousel.min.js' %}"></script>
<script src="{% static 'mysite/js/bootstrap-select.min.js' %}"></script>
<script src="{% static 'mysite/js/custom.js' %}"></script>
{% block script_section %}{% endblock %}

<!-- CHATBOT UI --> <!-- CHATBOT UI -->
<div class="chatbot-wrapper">
  <div class="robot-head">
    <img src="{% static 'mysite/images/Optilumelogo.png' %}" alt="Bot" />
  </div>
  <div class="speech-bubble" id="chat-box">
    <p class="bot-msg">ðŸ¤– Hello, I'm Opti!</p>
  </div>
  <div class="chat-input-area">
    <input type="text" id="user-input" placeholder="Where should I navigate you?" />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<!-- STYLING -->
<style>
  .chatbot-wrapper {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 300px;
    z-index: 9999;
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .robot-head img {
    width: 80px;
    height: 80px;
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }

  .speech-bubble {
    max-height: 280px;
    overflow-y: auto;
    background: #fff;
    padding: 14px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    width: 100%;
    font-size: 14px;
    position: relative;
  }

  .speech-bubble::before {
    content: "";
    position: absolute;
    bottom: 100%;
    left: 25px;
    border-width: 10px;
    border-style: solid;
    border-color: transparent transparent #fff transparent;
  }

  .speech-bubble p, .speech-bubble ul { margin: 6px 0; color: #333; }
  .bot-msg { color: #007bff; font-weight: 500; }

  .chat-input-area {
    display: flex; width: 100%;
  }

  .chat-input-area input {
    flex: 1;
    padding: 10px;
    border-radius: 10px 0 0 10px;
    border: 1px solid #ccc;
    outline: none;
    font-size: 14px;
  }

  .chat-input-area button {
    background-color: #007bff;
    color: white;
    padding: 10px 14px;
    border: none;
    border-radius: 0 10px 10px 0;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .chat-input-area button:hover {
    background-color: #0056b3;
  }
</style>

<!-- CHATBOT SCRIPT -->
<script>
  async function sendMessage() {
    const input = document.getElementById("user-input");
    const chatBox = document.getElementById("chat-box");
    const message = input.value.trim().toLowerCase();
    if (!message) return;

    chatBox.innerHTML += `<p><strong>You:</strong> ${message}</p>`;
    input.value = "";

    // Handle navigation
    if (message.includes("job") && message.includes("listing")) {
      chatBox.innerHTML += `<p><strong>Bot:</strong> Sure! Taking you to the <a href="/job-listings.html">Job Listings</a> page...</p>`;
      setTimeout(() => window.location.href = "/job-listings.html", 1500);
      return;
    } else if (message.includes("about")) {
      chatBox.innerHTML += `<p><strong>Bot:</strong> Redirecting you to the <a href="/about.html">About</a> page...</p>`;
      setTimeout(() => window.location.href = "/about.html", 1500);
      return;
    } else if (message.includes("contact")) {
      chatBox.innerHTML += `<p><strong>Bot:</strong> Here's the <a href="/contact.html">Contact</a> page...</p>`;
      setTimeout(() => window.location.href = "/contact.html", 1500);
      return;
    }

    // API Call to Django
    try {
      const response = await fetch("/chat/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCSRFToken()
        },
        body: JSON.stringify({ message: message })
      });
      const data = await response.json();
      chatBox.innerHTML += `<div><strong>Bot:</strong><ul>${data.reply}</ul></div>`;
      chatBox.scrollTop = chatBox.scrollHeight;
    } catch (err) {
      chatBox.innerHTML += `<p style="color:red;"><strong>Bot:</strong> Error contacting AI.</p>`;
      console.error(err);
    }
  }

  function getCSRFToken() {
    const cookies = document.cookie.split(";");
    for (let cookie of cookies) {
      const [name, val] = cookie.trim().split("=");
      if (name === "csrftoken") return decodeURIComponent(val);
    }
    return "";
  }
</script>
</body>
</html>

